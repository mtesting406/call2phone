/**
*
* Â© 2019 TranslateYourWorld - All rights reserved. ( version: 1.0.65 )
*
*/
var _,P,b,k,D,O,B,U,M,x,N,W,G,H,Y,F,V,z,j={"es-es":{female:{voice:"Leonor"},male:{voice:"Jorge"}},"ar-ar":{female:{voice:"leila22k"},male:{voice:"mehdi22k"}},"sv-se":{female:{voice:"Maja"},male:{voice:"erik22k"}},"en-us":{female:{voice:"Sophie"},male:{voice:"Mark"}},"en-gb":{female:{voice:"en_gb_amy"},male:{voice:"en_gb_brian"}},en:{female:{voice:"Sophie"},male:{voice:"Mark"}},es:{female:{voice:"Leonor"},male:{voice:"Jorge"}},fr:{female:{voice:"Elise"},male:{voice:"Thomas"}},pt:{female:{voice:"Amalia"},male:{voice:"Eusebio"}},ru:{female:{voice:"Milena"},male:{voice:"Yuri"}},zn:{female:{voice:"Liang"},male:{voice:"Hui"}},th:{female:{voice:"Somsi"},male:{voice:"Sarawut"}},tr:{female:{voice:"Zeynep"},male:{voice:"Kerem"}},ro:{female:{voice:"Simona"},male:{voice:"Simona"}},pl:{female:{voice:"Zosia"},male:{voice:"Krzysztof"}},no:{female:{voice:"bente22k"},male:{voice:"olav22k"}},nl:{female:{voice:"Claire"},male:{voice:"Xander"}},ko:{female:{voice:"Jihun"},male:{voice:"Yumi"}},ja:{female:{voice:"Sayaka"},male:{voice:"Akira"}},it:{female:{voice:"Paola"},male:{voice:"Luca"}},hi:{female:{voice:"Lekha"},male:{voice:"Lekha"}},de:{female:{voice:"de_marlene"},male:{voice:"max"}},ar:{female:{voice:"leila22k"},male:{voice:"mehdi22k"}}},J=!0,e={MALE:"male",FEMALE:"female"},q={NOT_AVAILABLE:0,INCOMING:1,OUTGOING:2},X={audioResultType:DAROWS.AUDIO_RESULT_TYPE.WAV_BLOB,sampleRate:16e3,speechDetectionThreshold:20,speechDetectionMinimum:10,speechDetectionMaximum:6e3,speechDetectionAllowedDelay:200,analysisChunkLength:100,compressPauses:!1,detectOnly:!1,debugAlerts:!1,debugConsole:!1},K={audioResultType:DAROWS.AUDIO_RESULT_TYPE.WAV_BLOB,sampleRate:16e3,speechDetectionThreshold:20,speechDetectionMinimum:10,speechDetectionMaximum:6e3,speechDetectionAllowedDelay:200,analysisChunkLength:100,compressPauses:!1,detectOnly:!1,debugAlerts:!1,debugConsole:!1},Z=100,Q=!1,ee=!1,ne=!1,oe=[],te=!1,ie=!1,ae=q.NOT_AVAILABLE,ce={localLanguage:"en-US",remoteLanguage:"en-US",ttsVoice:"Mark",ttsGender:e.MALE};$(function(){function c(e){ne||(e?"twilio"===k&&(t(!0),F||(F=Y.createMediaStreamDestination()),W.mediaStream.setInputTracksFromStream(F.stream),F.stream.getAudioTracks()[0].enabled=!0,ne=!0):t(!1))}function n(e){e!==Q&&(Q=e,W&&c(Q))}function o(e){e!==ee&&(ee=e)}function r(){return Q}function t(e){W&&W.mediaStream&&W.mediaStream.mute(e)}function l(e){if(e){var n=document.getElementById("log");n.innerHTML+="<p>&gt;&nbsp;"+e+"</p>",n.scrollTop=n.scrollHeight}}function s(){_.start(K,e,i,a)}function u(e){P.start(X,m,g,p,e)}function e(e,n){switch(n){case DAROWS.AUDIO_RESULT_TYPE.WAV_BLOB:if(z&&function(e){try{var n=new FileReader;n.onload=function(e){var n=document.createElement("AUDIO");n.controls=!0,n.src=e.target.result,n.type="audio/wav",document.getElementById("localAudioLog").appendChild(n)},n.readAsDataURL(e)}catch(e){}}(e),r())t=e,a=i=null,re.transcribeSpeech(t,ce.localLanguage,function(e){i=e,re.translateText(e,y(),R(),function(e){a=e,re.requestAudioTTS(e,R(),ce.ttsVoice,function(e){var n=new FileReader;n.onload=function(e){var n=e.target.result;Y.decodeAudioData(n).then(function(e){oe.push({audio:e,originalMessage:i,translatedMessage:a})})},n.readAsArrayBuffer(e)},function(e){})},function(e){})},function(e){});else{var o=new FileReader;o.onload=function(e){var n=e.target.result;Y.decodeAudioData(n).then(function(e){oe.push({audio:e,originalMessage:null,translatedMessage:null})})},o.readAsArrayBuffer(e)}}var t,i,a}function i(e){}function a(e){J&&d(e,"* handleSpeechCaptureEventLocal: ")}function d(e,n){switch(e){case DAROWS.STATUS.CAPTURE_STARTED:case DAROWS.STATUS.CAPTURE_STOPPED:case DAROWS.STATUS.SPEECH_STARTED:case DAROWS.STATUS.ENCODING_ERROR:case DAROWS.STATUS.CAPTURE_ERROR:case DAROWS.STATUS.SPEECH_ERROR:case DAROWS.STATUS.SPEECH_MAX_LENGTH:case DAROWS.STATUS.SPEECH_MIN_LENGTH:case DAROWS.STATUS.SPEECH_STOPPED:}}function m(e,n){switch(n){case DAROWS.AUDIO_RESULT_TYPE.WAV_BLOB:z&&function(e){try{var n=new FileReader;n.onload=function(e){var n=document.createElement("AUDIO");n.controls=!0,n.src=e.target.result,n.type="audio/wav",document.getElementById("audioLog").appendChild(n)},n.readAsDataURL(e)}catch(e){}}(e),ee&&(o=e,t=function(e){var n,o;n=e,o=document.getElementById("log"),n="CALLER: "+n,o.innerHTML+='<p style="color: white">&gt;&nbsp;'+n+"</p>",o.scrollTop=o.scrollHeight},i=function(e){},re.transcribeSpeech(o,ce.remoteLanguage,function(e){re.translateText(e,R(),y(),function(e){t&&t(e)},function(e){i&&i(e)})},function(e){i&&i(e)}))}var o,t,i}function f(e,n){if(n=n||0,e){var o=document.getElementById("log");e="YOU: "+e,o.innerHTML+=0!==n?'<p style="color: #8fff00">&gt;&nbsp;'+e+'</p> <p style="color: #16ff35">&gt;&nbsp;'+n+"</p>":'<p style="color: #8fff00">&gt;&nbsp;'+e+"</p> ",o.scrollTop=o.scrollHeight}}function g(e){}function p(e){J&&d(e)}function v(){l("CallProvider - Ready to accept incoming calls!"),document.getElementById("call-controls").style.display="block",$("#button-call").show(),$("#button-hangup").hide()}function h(e){l("CallProvider - Error: "+e)}function T(e,n,o){var t,i,a;l("CallProvider - Call connected!"),$("#button-call").hide(),$("#button-hangup").show(),b.supportsVolumeIndicators&&U.show(),re.start(),ie=!0,ne=te=!(oe=[]),C(),i=n,a=e,W=t=o,ae===q.OUTGOING?setTimeout(function(){G=t.getLocalStream(),H=t.getRemoteStream(),u(t.getRemoteStream()),c(r()),s()},1e3):(G=i,u(H=a),c(r()),s())}function A(){l("CallProvider - Call ended!"),re.stop(),ie=!1,ae=q.NOT_AVAILABLE,$("#button-call").show(),$("#button-hangup").hide(),U.hide(),_.stop(),P.stop(),H=G=W=null,ne=!1,V&&(V.stop(),V=null)}function S(e){l("CallProvider - Incoming call from: "+e),ae=q.INCOMING,b.answer()}function L(e){l("CallProvider - Ringing: "+e)}function w(e,n){var o="red";e<.5?o="green":e<.75&&(o="yellow"),B.css("width",Math.floor(300*e)+"px"),B.css("background",o);var t="red";n<.5?t="green":n<.75&&(t="yellow"),O.css("width",Math.floor(300*n)+"px"),O.css("background",t)}function E(e){l("CallProvider - Exception: "+e),$("#button-hangup").hide()}function C(){if(ie){if(!te)if(oe&&0<oe.length)!function(e){if(ne&&F){te=!0;var n=e.audio,o=e.originalMessage,t=e.translatedMessage;(V=Y.createBufferSource()).buffer=n,V.connect(F),V.onended=function(){te=!1};var i=document.getElementById("language_selection_remote");i=(i=i.options[i.selectedIndex].innerText).split(","),Bilingual.checked?f(o,i[0]+": "+t):f(o),V.start()}}(oe.shift());setTimeout(C,Z)}}function y(){return ce.localLanguage.split("-")[0]}function R(){return ce.remoteLanguage.split("-")[0]}function I(){var e,n,o=(e=ce.remoteLanguage,n=ce.ttsGender,e=e.toLowerCase(),j[e]?j[e][n].voice:j[e.split("-")[0]]?j[e.split("-")[0]][n].voice:j["en-us"].male.voice);ce.ttsVoice=o}document.getElementById("gender").onchange=function(){var e=document.getElementById("gender");ce.ttsGender=e.options[e.selectedIndex].value,I()},ce.ttsGender=$("#gender").find(":selected").val(),document.getElementById("language_selection_local").onchange=function(){var e=document.getElementById("language_selection_local");ce.localLanguage=e.options[e.selectedIndex].value},ce.localLanguage=$("#language_selection_local").find(":selected").val(),document.getElementById("language_selection_remote").onchange=function(){var e=document.getElementById("language_selection_remote");ce.remoteLanguage=e.options[e.selectedIndex].value,I()},ce.localLanguage=$("#language_selection_remote").find(":selected").val(),I(),O=$("#output-volume"),B=$("#input-volume"),U=$("#volume-indicators"),$("#ready-button").on("click",function(){$("#ready-button").hide(),$.getJSON("local-configuration.json",function(e){Y||(Y=new(window.AudioContext||window.webkitAudioContext)),X.audioContext=Y,K.audioContext=Y,D=e,P=new DAROWS,_=new DAROWS,re.init(D.TYWI,l),function(e){var n={ready:v,error:h,connected:T,disconnected:A,incoming:S,ringing:L,exception:E,volume:w};switch(e=e.toLowerCase()){case"twilio":k="twilio",b=new se;break;case"plivo":k="plivo",b=new le;break;default:return k=null,l(e?"CallProvider '"+e+"' is not supported! Use 'twilio' or 'plivo' instead.":"No callProvider (useCallProvider) set in the local configuration!")}D&&D.callProviders&&D.callProviders.hasOwnProperty(k)&&(b.init(D.callProviders[k],n,l),l("CallProvider init: "+k))}(D.useCallProvider),n(x.is(":checked")),o(N.is(":checked")),D.audioLog&&($("#localAudioLog").fadeIn(500),$("#audioLog").fadeIn(),z=!0)}).catch(function(e){})}),$("#button-hangup").on("click",function(){b&&b.hangup()}),$("#button-call").on("click",function(){var e=document.getElementById("phone-number").value;/^\+(?:[0-9] ?){6,14}[0-9]$/.test(e)&&b&&(b.call(e),ae=q.OUTGOING)}),(M=$("#Bilingual")).change(function(){this.checked=!0}),(x=$("#translateLocal")).change(function(){n(this.checked)}),(N=$("#translateRemote")).change(function(){o(this.checked)})});var re=function(){var d,s,u,o,m,t=1e4,i=!1,f=[],a=[],g=0;function c(t){return new Promise(function(e,n){var o={async:!0,crossDomain:!0,url:"https://api.worldwidetechconnections.com/api/Session",method:"GET",headers:{authorization:t}};$.ajax(o).done(e).fail(n)})}function p(e,n,o,t){a.push({id:e,type:n,successCB:o,errorCB:t,timestamp:(new Date).getTime()})}function r(){if(i){var n=100;try{if(a&&0<a.length)if(a[0].response){var e=a.shift();switch(e.type){case re.API_CALL_TYPES.TRANSCRIBE:e.response.recognizedText&&""!==e.response.recognizedText&&e.successCB&&e.successCB(e.response.recognizedText);break;case re.API_CALL_TYPES.TTS:case re.API_CALL_TYPES.TRANSLATE:e.successCB&&e.successCB(e.response)}}else(o=a[0]).timestamp&&o.timestamp+t<(new Date).getTime()&&a.splice(0,1);a&&0<a.length&&a[0].response&&(n=0)}catch(e){n=500}setTimeout(r,n)}var o}function v(e,n){for(var o=0;o<a.length;o++)if(a[o].id===e){a[o].response=n,a[o].responseTimestamp=(new Date).getTime();break}}function e(){return i}return{API_CALL_TYPES:{TRANSCRIBE:10,TRANSLATE:20,TTS:30},init:function(e,n){o=n||function(e){},d=(m=e).speech.vendor||"Microsoft",s=m.translate.vendor||"Microsoft",u=m.speak.vendor||"Microsoft",Promise.all([c(m.speech.translateyourworldapi),c(m.translate.translateyourworldapi),c(m.speak.translateyourworldapi)]).then(function(e){f[0]=e[0].token,f[1]=e[1].token,f[2]=e[2].token;for(var n=0;n<f.length;n++);}).catch(function(e){!function(e,n){if(e)for(var o=0;o<a.length;o++)if(a[o].id===e){a[o].responseTimestamp=(new Date).getTime(),a[o].errorCB&&a[o].errorCB(n),a.splice(o,1);break}}(null,e)}),o("WWTC init - Successful!")},transcribeSpeech:function(e,n,o,t){var i=m.speech.translateyourworldapi,a="sourceLanguage="+n,c="vendor="+d,r="https://api.worldwidetechconnections.com/api/SpeechToText?token="+f[0]+"&"+c+"&"+a,l=g;p(l,re.API_CALL_TYPES.TRANSCRIBE,o,t);var s=new FormData;s.append("file",e,"ORIGINAL.wav");var u={async:!0,crossDomain:!0,url:r,method:"POST",headers:{authorization:i},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:s,localItem:l,success:function(e){var n=JSON.parse(e);v(this.localItem,n)},error:function(e,n,o){t&&t(o)}};$.ajax(u),g++},translateText:function(e,n,o,t,i){var a=m.translate.translateyourworldapi,c="text="+e+"&sourceLanguage="+n+"&targetLanguage="+o+"&vendor="+s+"&token="+f[1],r=g;p(r,re.API_CALL_TYPES.TRANSLATE,t,i);var l={async:!0,crossDomain:!0,url:"https://api.worldwidetechconnections.com/api/Translation?"+c,method:"GET",headers:{authorization:a},localItem:r,success:function(e){v(this.localItem,e.targetText)},error:function(e,n,o){i&&i(o)}};$.ajax(l),g++},requestAudioTTS:function(e,n,o,t,i){o=o||"en_gb_brian";var a=m.speak.translateyourworldapi,c="https://api.worldwidetechconnections.com/api/TextToSpeech?text="+e+"&sourcelanguage="+n+"&vendor="+u+"&token="+f[2]+"&voice="+o,r=g;p(r,re.API_CALL_TYPES.TTS,t,i);var l=new XMLHttpRequest;l.open("GET",c),l.responseType="arraybuffer",l.localItem=r,l.onload=function(){if(200===this.status){var e=new Blob([this.response],{type:"audio/mp3"});v(l.localItem,e)}},l.onerror=function(e){i&&i(e)},l.ontimeout=function(e){i&&i(e)},l.onabort=function(e){i&&i(e)},l.setRequestHeader("Authorization",a),l.send(),g++},start:function(){e()||(i=!0,r())},isStarted:e,stop:function(){i=!1,a=[],g=0}}}(),le=function(){var t,i,a,c,r={debug:"DEBUG",permOnClick:!0,enableTracking:!0};function e(){}return{init:function(e,n,o){o||function(e){},t=e,i=n,(a=new window.Plivo(r)).client.on("onWebrtcNotSupported",function(){i.error&&i.error("WebRTC is not supported on this browser!")}),a.client.on("onLogin",function(){i.ready&&i.ready()}),a.client.on("onLogout",function(){}),a.client.on("onLoginFailed",function(e){i.error&&i.error("Failed to login to Plivo: "+e)}),a.client.on("onCallRemoteRinging",function(e){c=e,i.incoming&&i.incoming()}),a.client.on("onIncomingCallCanceled",function(e){c=void 0,i.disconnected&&i.disconnected()}),a.client.on("onCallFailed",function(e,n){i.error&&i.error("Failed call: "+e)}),a.client.on("onCallAnswered",function(e){var n=a.client.getPeerConnection();if(n.pc&&!window.localStream){var o=n.pc.getRemoteStreams()[0];i.connected&&i.connected(o)}}),a.client.on("onCallTerminated",function(e,n){c=void 0,i.disconnected&&i.disconnected()}),a.client.on("onCalling",function(){i.ringing&&i.ringing()}),a.client.on("onIncomingCall",function(e,n,o){c=o,i.incoming&&i.incoming()}),a.client.on("onMediaPermission",function(){}),a.client.on("mediaMetrics",function(){}),a.client.on("onConnectionChange",function(){}),a.client.login(t.username,t.password)},answer:function(){c?a.client.answer(c.callUUID):a.client.answer()},hangup:e,call:function(e){},supportsVolumeIndicators:function(){return!1}}},se=function(){var t,i,a,c,r,l={debug:!1,allowIncomingWhileBusy:!1};return{init:function(e,n,o){t=o||function(e){},i=e,c=n,$.getJSON(i.capabilityTokenFunctionURL).then(function(e){e.token,e.identity,(a=new Twilio.Device).setup(e.token,l),a.on("ready",function(){c.ready&&c.ready()}),a.on("error",function(e){c.error&&c.error(e.message)}),a.on("connect",function(e){var n;r=e,c.connected&&c.connected(e.getRemoteStream(),e.getLocalStream(),e),n=e,c.volume&&n.on("volume",function(e,n){c.volume(e,n)})}),a.on("disconnect",function(){r=void 0,c.disconnected&&c.disconnected()}),a.on("incoming",function(e){r=e,c.incoming&&c.incoming(e.parameters.From)})}).catch(function(e){t("Twilio token error"+e),c.exception&&c.exception(e),r=void 0})},answer:function(){r&&r.accept()},hangup:function(){a&&a.disconnectAll()},call:function(e){var n={To:e};a&&a.connect(n)},supportsVolumeIndicators:function(){return!0}}};